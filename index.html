<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç´šæ‹¼å­—å¡ V3.0 - AIé…åœ–èˆ‡è©•åˆ†ç‰ˆ</title>
    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #00CEC9;
            --accent: #FD79A8;
            --bg: #DFE6E9;
            --card-bg: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        /* é ‚éƒ¨å°èˆª */
        .navbar {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .score-board { font-size: 1.2rem; font-weight: bold; margin-left: 20px; background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 20px;}

        /* å¡ç‰‡å®¹å™¨ */
        .container {
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        /* åœ–ç‰‡å€åŸŸ */
        .word-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin: 10px auto;
            border: 4px solid var(--secondary);
            background-color: #eee;
            display: block; /* é è¨­é¡¯ç¤º */
        }
        .word-image.hidden { display: none; }

        /* å–®å­—é¡¯ç¤ºå€ (æº«ç¿’æ¨¡å¼) */
        .chunk-container {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .chunk {
            font-size: 42px;
            font-weight: 800;
            padding: 5px 10px;
            border-radius: 12px;
            color: white;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.2);
            font-family: 'Comic Sans MS', sans-serif;
        }
        /* è‡ªå‹•å¾ªç’°é¡è‰² */
        .chunk:nth-child(4n+1) { background-color: #FF7675; }
        .chunk:nth-child(4n+2) { background-color: #74B9FF; }
        .chunk:nth-child(4n+3) { background-color: #55EFC4; }
        .chunk:nth-child(4n+4) { background-color: #a29bfe; }

        .chinese-meaning {
            font-size: 24px;
            color: #636e72;
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* è¼¸å…¥æ¡† */
        input[type="text"] {
            font-size: 28px;
            padding: 12px;
            width: 80%;
            text-align: center;
            border: 3px solid #b2bec3;
            border-radius: 15px;
            outline: none;
            margin-bottom: 10px;
            background-color: #f8f9fa;
        }
        input:focus { border-color: var(--primary); background-color: #fff; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            margin: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }

        .btn-speak { background-color: var(--primary); }
        .btn-check { background-color: var(--secondary); }
        .btn-hint { background-color: #fab1a0; color: #333; font-size: 14px; }
        .btn-next { background-color: #636e72; }

        /* æ¨¡å¼åˆ‡æ›æ¨™ç±¤ */
        .mode-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }
        .mode-study { background-color: #00b894; }
        .mode-test { background-color: #d63031; }

        /* éš±è—å…ƒç´ å·¥å…· */
        .hidden { display: none !important; }

        /* åé¥‹è¨Šæ¯ */
        #feedback { font-size: 20px; font-weight: bold; min-height: 30px; margin-top: 10px;}

        /* å®¶é•·è¨­å®šå€ */
        .settings {
            width: 90%;
            max-width: 600px;
            margin: 30px auto;
            border: 2px dashed #b2bec3;
            padding: 20px;
            border-radius: 15px;
            background: #fff;
        }
        textarea { width: 100%; height: 120px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px;}

    </style>
</head>
<body>

    <div class="navbar">
        <span>ğŸ† æ‹¼å­—å¤§æŒ‘æˆ°</span>
        <span class="score-board">åˆ†æ•¸: <span id="score-val">0</span></span>
    </div>

    <div style="margin-top: 20px;">
        <button class="btn" style="background:#00b894" onclick="switchMode('study')">ğŸ“– æº«ç¿’æ¨¡å¼ (Study)</button>
        <button class="btn" style="background:#d63031" onclick="switchMode('test')">ğŸ“ æ¸¬é©—æ¨¡å¼ (Test)</button>
    </div>

    <div class="container">
        <div class="card">
            <span id="mode-badge" class="mode-badge mode-study">æº«ç¿’ä¸­</span>

            <img id="dynamic-image" class="word-image" src="" alt="Word Image">
            <div id="image-placeholder" style="font-size:12px; color:#aaa; margin-bottom:10px;">(åœ–ç‰‡ç”± AI è‡ªå‹•ç”Ÿæˆ)</div>

            <div id="study-area">
                <div id="chunk-display" class="chunk-container"></div>
                <div id="chinese-display" class="chinese-meaning"></div>
            </div>

            <div id="test-area" class="hidden">
                <div style="font-size:60px; cursor:pointer; margin:20px;" onclick="speakCurrent()">ğŸ”Š</div>
                <p style="color:#666">é»æ“Šå–‡å­è½ç™¼éŸ³</p>
            </div>

            <input type="text" id="user-input" placeholder="è¼¸å…¥å–®å­—..." autocomplete="off">
            <div id="feedback"></div>

            <div class="btn-group">
                <button class="btn btn-speak" onclick="speakCurrent()">ğŸ—£ï¸ ç™¼éŸ³</button>
                <button class="btn btn-check" onclick="checkAnswer()">âœ… æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint hidden" id="btn-hint" onclick="useHint()">ğŸ’¡ æç¤º (-3åˆ†)</button>
                <button class="btn btn-next" onclick="nextWord()">â¡ï¸ ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>
    </div>

    <div class="settings">
        <h3 onclick="toggleSettings()" style="cursor:pointer">âš™ï¸ å®¶é•·è¨­å®š / è¼¸å…¥å–®å­— (é»æ“Šå±•é–‹)</h3>
        <div id="settings-panel" style="display:none">
            <p>è«‹è¼¸å…¥ï¼š<b>è‹±æ–‡å–®å­— ä¸­æ–‡è§£é‡‹</b> (ä¸­é–“ç”¨ç©ºæ ¼æˆ–é€—è™Ÿéš”é–‹)<br>ä¸€è¡Œä¸€å€‹ã€‚</p>
            <textarea id="bulk-input" placeholder="Elephant å¤§è±¡&#10;Computer é›»è…¦&#10;Delicious ç¾å‘³çš„"></textarea>
            <button class="btn btn-speak" style="width:100%; margin-top:10px;" onclick="saveWords()">ğŸ’¾ å„²å­˜ä¸¦æ›´æ–°</button>
        </div>
    </div>

<script>
    // --- è³‡æ–™èˆ‡ç‹€æ…‹ ---
    let words = [];
    let currentIndex = 0;
    let currentMode = 'study'; // 'study' or 'test'
    let score = 0;
    let hintUsed = false;
    
    // é è¨­è³‡æ–™
    const defaultRaw = "Elephant å¤§è±¡\nBanana é¦™è•‰\nUmbrella é›¨å‚˜\nHappiness å¿«æ¨‚";

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        const stored = localStorage.getItem("spelling_v3_words");
        const raw = stored ? stored : defaultRaw;
        document.getElementById("bulk-input").value = raw;
        parseWords(raw);
        loadWord();
    };

    // --- æ ¸å¿ƒåŠŸèƒ½ 1: è§£æè¼¸å…¥ (è‹±æ–‡ + ä¸­æ–‡) ---
    function parseWords(text) {
        const lines = text.split(/\n/);
        words = [];
        lines.forEach(line => {
            line = line.trim();
            if(!line) return;
            
            // å˜—è©¦åˆ†å‰²è‹±æ–‡å’Œä¸­æ–‡
            // å‡è¨­ç¬¬ä¸€å€‹ç©ºæ ¼æˆ–é€—è™Ÿåˆ†é–‹
            let parts = line.split(/[\s,ï¼Œ]+/); 
            if(parts.length >= 2) {
                const en = parts[0];
                const cn = parts.slice(1).join(" "); // å‰©ä¸‹çš„éƒ½æ˜¯ä¸­æ–‡
                words.push({ en: en, cn: cn });
            } else {
                words.push({ en: parts[0], cn: "(æœªæä¾›ä¸­æ–‡)" });
            }
        });
        localStorage.setItem("spelling_v3_words", text);
    }

    function saveWords() {
        parseWords(document.getElementById("bulk-input").value);
        currentIndex = 0;
        score = 0;
        updateScore(0);
        loadWord();
        alert("å–®å­—è¡¨å·²æ›´æ–°ï¼");
        toggleSettings();
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ 2: è‡ªå‹•æ‹†å­— (Auto Chunking) ---
    function generateChunks(word) {
        // ç°¡å–®é‚è¼¯ï¼šæ¯ 3 å€‹å­—æ¯åˆ‡ä¸€æ®µï¼Œå¦‚æœæœ€å¾Œå‰© 1 å€‹ï¼Œä½µå…¥ä¸Šä¸€æ®µ
        // ä¾‹å¦‚ Elephant -> Ele - pha - nt
        const chunks = [];
        const len = word.length;
        let i = 0;
        
        while(i < len) {
            let size = 3;
            // å¦‚æœå‰©ä¸‹ 4 å€‹å­—ï¼Œæ‹†æˆ 2+2 æœƒæ¯”è¼ƒå¥½çœ‹ (Optionally)
            // é€™è£¡ç¶­æŒç°¡å–®ï¼šå‰©ä¸‹ 1 å€‹å­—æ™‚ï¼Œä½µå…¥å‰ä¸€å€‹
            if (len - i === 4) size = 2; // å„ªåŒ–çµå°¾
            
            let chunk = word.substr(i, size);
            chunks.push(chunk);
            i += size;
        }
        return chunks;
    }

    // --- æµç¨‹æ§åˆ¶ ---
    function switchMode(mode) {
        currentMode = mode;
        const badge = document.getElementById("mode-badge");
        
        if(mode === 'study') {
            badge.innerText = "æº«ç¿’æ¨¡å¼";
            badge.className = "mode-badge mode-study";
            document.getElementById("study-area").classList.remove("hidden");
            document.getElementById("test-area").classList.add("hidden");
            document.getElementById("dynamic-image").classList.remove("hidden"); // é¡¯ç¤ºåœ–ç‰‡
            document.getElementById("image-placeholder").classList.remove("hidden");
            document.getElementById("btn-hint").classList.add("hidden"); // æº«ç¿’ä¸éœ€è¦æç¤º
            document.getElementById("user-input").placeholder = "è©¦è‘—è¼¸å…¥ç·´ç¿’...";
        } else {
            badge.innerText = "æ¸¬é©—æ¨¡å¼";
            badge.className = "mode-badge mode-test";
            document.getElementById("study-area").classList.add("hidden");
            document.getElementById("test-area").classList.remove("hidden");
            document.getElementById("dynamic-image").classList.add("hidden"); // éš±è—åœ–ç‰‡
            document.getElementById("image-placeholder").classList.add("hidden");
            document.getElementById("btn-hint").classList.remove("hidden"); // æ¸¬é©—å¯æç¤º
            document.getElementById("user-input").placeholder = "è½éŸ³è¼¸å…¥...";
            
            // æ¸¬é©—é–‹å§‹æ™‚è‡ªå‹•ç™¼éŸ³
            setTimeout(speakCurrent, 500);
        }
        
        // é‡ç½®ç‹€æ…‹
        document.getElementById("user-input").value = "";
        document.getElementById("feedback").innerText = "";
        hintUsed = false;
        document.getElementById("user-input").focus();
    }

    function loadWord() {
        if(words.length === 0) return;
        const item = words[currentIndex];
        
        // 1. è¨­å®šåœ–ç‰‡ (ä½¿ç”¨ Pollinations AI)
        // æ ¼å¼: https://image.pollinations.ai/prompt/{keyword}
        const cleanWord = item.en.replace(/[^a-zA-Z]/g, "");
        const imgUrl = `https://image.pollinations.ai/prompt/cartoon ${cleanWord} illustration?width=400&height=400&nologo=true&seed=${Math.random()}`;
        document.getElementById("dynamic-image").src = imgUrl;

        // 2. è¨­å®šæ‹†å­—é¡¯ç¤º (Chunking)
        const chunkDiv = document.getElementById("chunk-display");
        chunkDiv.innerHTML = "";
        const chunks = generateChunks(item.en);
        chunks.forEach(c => {
            const span = document.createElement("span");
            span.className = "chunk";
            span.innerText = c;
            chunkDiv.appendChild(span);
        });

        // 3. è¨­å®šä¸­æ–‡
        document.getElementById("chinese-display").innerText = item.cn;

        // 4. æ¸…ç†ä»‹é¢
        document.getElementById("user-input").value = "";
        document.getElementById("feedback").innerText = "";
        document.getElementById("user-input").style.borderColor = "#b2bec3";
        hintUsed = false;

        // ä¿æŒç•¶å‰æ¨¡å¼
        switchMode(currentMode);
    }

    function checkAnswer() {
        const input = document.getElementById("user-input");
        const userVal = input.value.trim().toLowerCase();
        const correctVal = words[currentIndex].en.toLowerCase();
        const feedback = document.getElementById("feedback");

        if (userVal === correctVal) {
            // ç­”å°
            feedback.innerText = "ğŸ‰ ç­”å°äº†ï¼ Correct!";
            feedback.style.color = "#00b894";
            input.style.borderColor = "#00b894";
            
            // è¨ˆç®—åˆ†æ•¸ (åªåœ¨æ¸¬é©—æ¨¡å¼ä¸”æœªç®—éåˆ†æ™‚)
            if (currentMode === 'test') {
                let points = 10;
                if (hintUsed) points = 5; // ç”¨æç¤ºæ‰£åˆ†
                updateScore(points);
                speak("Correct!");
                // è‡ªå‹•ä¸‹ä¸€é¡Œ
                setTimeout(nextWord, 1500);
            } else {
                // æº«ç¿’æ¨¡å¼ä¸è¨ˆåˆ†ï¼Œåªçµ¦é¼“å‹µ
                speak("Good job!");
                setTimeout(nextWord, 1000);
            }

        } else {
            // ç­”éŒ¯
            feedback.innerText = "âŒ éŒ¯èª¤ï¼Œå†è©¦ä¸€æ¬¡";
            feedback.style.color = "#d63031";
            input.style.borderColor = "#d63031";
            speak("Try again");
            
            // éœ‡å‹•æ•ˆæœ
            input.animate([
                { transform: 'translateX(0)' },
                { transform: 'translateX(-10px)' },
                { transform: 'translateX(10px)' },
                { transform: 'translateX(0)' }
            ], { duration: 300 });
        }
    }

    function useHint() {
        if (currentMode !== 'test') return;
        hintUsed = true;
        const word = words[currentIndex].en;
        // æç¤ºé¡¯ç¤ºé ­å°¾å­—æ¯
        const hintText = word[0] + " ... " + word[word.length-1];
        document.getElementById("feedback").innerText = "æç¤º: " + hintText;
        document.getElementById("feedback").style.color = "#fab1a0";
        document.getElementById("user-input").focus();
    }

    function nextWord() {
        currentIndex++;
        if(currentIndex >= words.length) {
            alert("æ­å–œï¼å…¨éƒ¨å®Œæˆï¼ç¸½åˆ†ï¼š" + score);
            currentIndex = 0;
            score = 0;
            updateScore(0);
        }
        loadWord();
    }

    function updateScore(points) {
        if(points === 0) score = 0; // é‡ç½®
        else score += points;
        document.getElementById("score-val").innerText = score;
    }

    // --- èªéŸ³ ---
    function speakCurrent() {
        const word = words[currentIndex].en;
        speak(word);
    }
    
    function speak(text) {
        const synth = window.speechSynthesis;
        if (synth.speaking) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'en-US';
        synth.speak(u);
    }

    function toggleSettings() {
        const p = document.getElementById("settings-panel");
        p.style.display = p.style.display === "none" ? "block" : "none";
    }
    
    // Enter éµæäº¤
    document.getElementById("user-input").addEventListener("keypress", function(e){
        if(e.key === "Enter") checkAnswer();
    });

</script>

</body>
</html>
